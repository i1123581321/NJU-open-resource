# 06

On Java 第十二章的阅读笔记，主要内容是集合

集合类用于保存大量的对象，基本的类型包括：list，set，queue，map

集合都可以动态调整大小以容纳任意多的对象

Java 的集合都实现了泛型，使用泛型可以避免类型错误，同时使用泛型也可以避免取出元素时的强制类型转换

## 基本概念

Java 的集合类分为两个不同的概念，表现为两个基本的接口

* 集合（Collection）：独立元素的序列，其中的元素服从不同的规则
  * List 以插入顺序保存元素
  * Set 中元素不能重复
  * Queue 按照特定规则来确定对象的顺序
* 映射（Map）：一系列键值对的组合，可以通过键查找值

大部分情况下都是使用接口，只在初始化时使用具体类型

```java
List<Apple> apples = new ArrayList<>();
```

Java 为集合接口提供了不同的标准实现，但是如果想要使用底层实现额外的功能就不能使用接口而要使用更精确的类型

## 添加元素

有许多方法可以在集合中添加一组元素

`Arrays.asList()` 接受一个数组或是一个逗号分隔的元素列表并且将其转换为 `List` 对象

`Collections.addAll()` 接受一个集合对象以及一个数组或者逗号分隔的元素列表，将其中的元素添加到集合中

集合对象本身也有 `addAll()` 方法，接受一个数组或是逗号分隔的元素列表

集合对象的构造器可以接受另一个集合对象并用其中的元素初始化

使用 `Arrays.asList()` 方法获得的 List 不能通过 `add()` 或 `remove()` 调整大小，调用时会产生一个运行时错误

## 列表 List

`List` 在 `Collection` 接口的基础上添加了许多独有的操作，包括可以在列表中间插入或删除元素。列表有两种基本的实现

* `ArrayList` 随机访问较快，但是在中间插入和删除较慢
* `LinkedList` 在中间插入删除的代价较低，但随机访问效率较低

可以用 `contains()` 方法确定某个对象是否在列表中。更多 List 支持的方法参见官方文档

## 迭代器 Iterator

迭代器是一种用于遍历序列的对象，使用迭代器的客户端不需要关心序列的底层实现，可以调用集合的 `iterator()` 方法获得一个指向序列开头的迭代器，其支持的操作非常有限

* `next()` 获取序列下一个元素
* `hasNext()` 检查是否还有下一个元素
* `remove()` 删除迭代器返回的元素，调用其之前必须先调用 `next()`

迭代器统一了对集合访问的方式

`ListIterator` 是由 List 生成的迭代器，可以双向移动，并且可以替换元素或者生成迭代器指向位置前后的索引

## 链表 LinkedList

链表也实现了基本的 `List` 接口，同时也提供了一些新的方法，可以将其用作栈/队列/双端队列

* `getFirst()` 和 `element()` 都返回列表第一个元素而并不删除它，如果 List 为空，则抛出 `NoSuchElementException` 异常。 `peek()` 在列表为空时返回 `null` 
* `removeFirst()` 和 `remove()` 删除并返回列表的头部元素，并在列表为空时抛出 `NoSuchElementException` 异常。 `poll()` 在列表为空时返回 `null` 
* `addFirst()` 在列表的开头插入一个元素
* `offer()` 与 `add()` 和 `addLast()` 在列表的尾部（末尾）添加一个元素
* `removeLast()` 删除并返回列表的最后一个元素

## 堆栈 Stack

栈是后进先出（LIFO）的集合。`java.util.Stack` 是一个失败的设计

可以基于 `Deque` 接口实现栈

## 集合 Set

`Set` 中不保存重复的元素，一般使用集合都是用于测试归属，因此查询是集合最重要的操作之一。`Set` 和 `Collection` 接口相同，只是行为不同

一般底层使用 `HashSet` 实现

`LinkedHashSet` 用链表维护元素按照插入顺序排序，`TreeSet` 用 RBT 实现，确保元素按其本身大小关系排序

## 映射 Map

Map 是键值对的集合

Map 能返回键组成的 Set，值组成的 Collection，或者键值对的 Set

`HashMap` 专为快速访问而设计，而 `TreeMap` 保持键始终处于排序状态，`LinkedHashMap` 按插入顺序保存其元素，但使用散列提供快速访问的能力

## 队列 Queue

队列是一个先进先出（FIFO）的集合，`LinkedList` 可以作为 `Queue` 的一种实现

FIFO 是默认的队列规则，也可以按照别的规则排序队列的元素的顺序，优先级队列 `PriorityQueue` 实现了这一规则，只需初始化时提供一个 `Comparator`

## 集合与迭代器

Java 的集合类通过共有的接口和迭代器联系在一起，一个自定义类如果想要有集合的功能或者是实现 `Collection` 接口，或者是继承 `AbstractCollection` 类，前者需要实现许多额外代码，后者在已有继承的情况下不适用，故一般常采用的方法是提供迭代器，如实现 `Iterable`